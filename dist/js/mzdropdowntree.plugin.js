"function"==typeof jQuery?$.fn.mzDropDownTree=function(e){var t,l="mz-tree-dropdown-plugin",d=this,e=$.extend(!0,{},{key:"default_field_name",data:{url:"URL",method:"GET",data:null},label:"Tree label",description:"",mode:"tree",default_value:[null],placeholder:"Click to Expand List",select_options:{max_nodes:-1,selected_node_maxwidth:152,toggle_select_parents:!0,toggle_parent_selects_children:!0,disable_children_on_parent_selection:!1,toggle_select_all_siblings:!1,toggle_select_all_siblings_label:"Select all [NODE_LABEL]",max_selection_displayed_nodes:3,more_nodes_text:" and [max] more"},filter_options:{text_filter:!0,min_text_characters:1},tree_options:{select_all:!0,select_all_text:"Select All",expand_all:!0,expand_all_text:"Expand All",show_selected:!0,show_selected_text:"Show Selected"}},e,this.data());async function n(e,l){var t=e.method||"GET",s=e.url,n=((t="GET"==t?(s=null!=e.data?(t=new URLSearchParams(e.data),e.url+"?"+t.toString()):e.url,{method:"GET"}):{method:"POST",headers:{"Content-Type":"application/json"},body:e.data}).headers={"Content-Type":"application/json"},l.html(""),$("<div />",{class:"tree-loader",html:""}).appendTo(l));createSpinner().appendTo(n),$(d).addClass("data-loading"),n.appendTo($(d)),$(d).find("input").attr("disabled","disabled"),await fetch(s,t).then(e=>e.json()).then(t=>{c=0,$.each(t,e=>{o(t[e],l),c++}),$(".total-nodes").html(c),n.remove(),$(d).removeClass("data-loading"),$(d).find("input").removeAttr("disabled","disabled")}).catch(e=>{console.error("Error:",e)})}function o(e,t){t=$("<div>",{class:"tree-node"}).appendTo(t);if(fieldType="checkbox",inputval=e.value,inputlabel=e.label,selectionWrapper=$("<div />",{class:"tree-node-item"}),field_id=d.id+"-"+inputval,field_name=d.key,(selectionCbox=$("<input />",{type:fieldType,name:field_name,id:field_id,value:inputval,class:"select-node"}).appendTo(selectionWrapper)).on("change",function(e){d.triggerSelectNode($(this)),$(this).is(":checked")?$(this).parent().addClass("node-checked"):$(this).parent().removeClass("node-checked"),d.treesettings.select_options.toggle_select_parents&&d.treesettings.select_options.toggle_parent_selects_children&&triggerSelectAllChildren($(this)),1==d.treesettings.select_options.disable_children_on_parent_selection&&disableChildren($(this))}),e.icon&&($icon=$("<div />",{class:"mz-tree-node-icon"}).appendTo(selectionWrapper),$("<"+e.icon.tag+"/>",e.icon.attributes).appendTo($icon)),label=$("<label />",{title:inputlabel,for:field_id,html:inputlabel}).appendTo(selectionWrapper),null!=e.children&&0<e.children.length||Number(parseFloat(e.children))&&0<e.children){(details=$("<details />").appendTo(t)).attr("data-value",inputval),details.attr("data-label",inputlabel),Number(parseFloat(e.children))&&0<e.children?details.attr("data-children",e.children):details.attr("data-children",e.children.length),summary=$("<summary />").appendTo(details);var l=$("<div>",{class:"tree-nodes"}).appendTo(details);if((d.treesettings.select_options.toggle_select_parents?(l.addClass("has-selectable-parent"),selectionWrapper):$("<span />",{html:e.label,class:"tree-node-item"})).appendTo(summary),d.treesettings.select_options.toggle_select_all_siblings&&!d.treesettings.select_options.toggle_select_parents&&(selectAllSibLings=$("<div />",{class:"select-all-siblings"}).appendTo(l),siblingSelectorCbox=$("<input />",{type:fieldType,id:"sibling-selector-"+e.value}).appendTo(selectAllSibLings),siblingSelectorLabel=d.treesettings.select_options.toggle_select_all_siblings_label,(siblingSelectorLabel=$("<label />",{html:siblingSelectorLabel,for:"sibling-selector-"+e.value}).appendTo(selectAllSibLings)).html(siblingSelectorLabel.text().replace("[NODE_LABEL]",'<span class="strong">'+e.label+"</strong>")),siblingSelectorCbox.on("change",function(e){triggerSelectAllSiblings($(this))})),null!=d.treesettings.data.url&&Number(parseFloat(e.children))&&0<e.children)details.on("click",function(e){(dopen=!$(this).is("[open]"))&&""==l.html()&&(d.treesettings.data.data={value:$(this).data("value"),label:$(this).data("label")},d.treesettings.onDetailOpen&&d.treesettings.onDetailOpen.call(d,$(this),d.treesettings.data),n(d.treesettings.data,l))});else for(var s=0;s<e.children.length;s++)o(e.children[s],l)}else selectionWrapper.appendTo(t)}return d.selectedNodes=[],d.treesettings=e,d.expandCollapseClass="mz-tree-show",init=()=>{$(d).html(""),$(d).addClass(l),d.key=d.treesettings.key,d.id=$(d).attr("id"),$(d).addClass(l+"-"+d.id),"flat"==d.treesettings.mode&&$(d).addClass("flat-list-tree"),filterid=d.id+"-mz-tree-dropdown-filter",$fieldLabel=$("<label />",{class:"mz-tree-dropdown-filter-label",for:filterid,html:d.treesettings.label}).appendTo($(d)),$tree_head=$("<div />",{class:"tree-header"}).appendTo($(d)),$tree_filter=$("<div />",{class:"tree-filter-control"}).appendTo($($tree_head)),$textfilter=$("<input />",{id:filterid,class:"mz-tree-dropdown-filter"}).appendTo($tree_filter),$selected_nodes=$("<div />",{class:"selected-nodes",id:"selected-nodes-"+d.id}).prependTo($tree_head),($trigger_icon=$("<button />",{class:"btn-trigger-tree-control",type:"button"}).appendTo($tree_head)).on("click",function(e){$(d).find(".mz-tree-dropdown-filter").focus()}),registerOnFilterEvents($textfilter),t=$("<div />",{class:"tree-body mz-tree-collapse"}).appendTo($(d)),""!=d.treesettings.description&&$("<p/>",{html:d.treesettings.description,class:"tree-description"}).insertAfter(t),$nodes_wrapper=$("<div />",{class:"tree-nodes-wrapper"}).appendTo(t),d.treesettings.data&&(d.treesettings.data.url?($tree=$nodes_wrapper,n(d.treesettings.data,$tree)):($tree=$nodes_wrapper,$.each(d.treesettings.data,e=>{o(d.treesettings.data[e],$tree)}))),null!=d.treesettings.tree_options&&buildTreeOptions(t),null==d.treesettings.default_value||"object"!=typeof d.treesettings.default_value&&"array"!=typeof d.treesettings.default_value||$.each(d.treesettings.default_value,function(e,t){null!=(chkbx=$(d).find("#"+d.id+"-"+t)).val()&&(clabel=chkbx.next("label").text(),chkbx.prop("checked",!0),chkbx.trigger("change"),d.updateSelectedNodeTags())}),d.treesettings.onTreeRender&&d.treesettings.onTreeRender.call(d,d)},registerOnFilterEvents=e=>{e.on("focus",function(e){$(".tree-body").each(function(){$(this).removeClass(d.expandCollapseClass)}),t.addClass(d.expandCollapseClass),t.attr("aria-expanded",!0),$(d).addClass("tree-active")}),e.on("focusout",function(e){$(d).removeClass("tree-active")}),d.treesettings.filter_options.text_filter?e.on("keyup",function(){for(""!=(filter=$(this).val())?($(this).parent().find(".btn-clear-input").length||(clearTextFilter=$("<button />",{type:"button",class:"btn-clear-input"}).appendTo($(this).parent())).on("click",function(){$(this).prev(".mz-tree-dropdown-filter").val(""),$(this).prev(".mz-tree-dropdown-filter").focus(),$(this).remove(),$(d).find(".tree-node-item").each(function(){$(this).removeAttr("style")}),$(d).find(".total-nodes").html(d.countAllNodes())}),d.treesettings.onTextFilterChange&&d.treesettings.onTextFilterChange.call(d,onTextFilterChange)):$(this).parent().find(".btn-clear-input").remove(),$(d).find("details").attr("open",!0),list=$(d).find(".tree-node-item"),matchResults=0,i=0;i<list.length;i++)a=list[i].getElementsByTagName("label")[0],""!=(txtValue=a.textContent||a.innerText)?-1<txtValue.toLowerCase().indexOf(filter)?(matchResults++,$(list[i]).show()):$(list[i]).hide():list[i].show();$(d).find(".total-nodes").html(matchResults)}):e.attr("readonly","readonly")},buildTreeOptions=function(e){treeOptions=$("<div />",{class:"tree-options"}).prependTo(e),buildToggleSelectAll(treeOptions),"tree"==d.treesettings.mode&&(buildToggleSelected(treeOptions),buildToggleExpandCollapse(e))},buildToggleSelectAll=e=>{d.treesettings.tree_options&&d.treesettings.tree_options.select_all&&(treeSelectAll=$("<div />",{class:"tree-option select-all-nodes"}).appendTo(e),treeSelectAllchkBx=$("<input />",{type:"checkbox",id:"select-all-"+d.id}).appendTo(treeSelectAll),treeSelectAllLabel=$("<label />",{type:"checkbox",for:"select-all-"+d.id,html:d.treesettings.tree_options.select_all_text+'<span class="node-stat total-nodes">'+d.countAllNodes()+"</span>"}).appendTo(treeSelectAll),treeSelectAllchkBx.on("change",function(){select_all_checked=$(this).is(":checked"),$(this).css("cursor","loading"),$(this).attr("disabled","disabled"),d.treesettings.select_options.toggle_select_children&&!d.treesettings.select_options.toggle_select_parents&&$(d).find(".select-all-siblings input[type=checkbox]").prop("checked",$(this).is(":checked")),$(d).find(".select-node").each(function(){$(this).prop("checked",select_all_checked),$(this).trigger("change")}),$(this).removeAttr("disabled"),$(this).removeAttr("style")}))},buildToggleSelected=e=>{d.treesettings.tree_options&&d.treesettings.tree_options.show_selected&&(treeShowSelected=$("<div />",{class:"tree-option select-selected-nodes"}).appendTo(treeOptions),treeSelectedchkBx=$("<input />",{type:"checkbox",id:"show-selected-nodes-"+d.id}).appendTo(treeShowSelected),treeShowSelectedLabel=$("<label />",{type:"checkbox",for:"show-selected-nodes-"+d.id,html:d.treesettings.tree_options.show_selected_text+'<span class="node-stat selected-count">'+d.countSelectedNodes()+"</span>"}).appendTo(treeShowSelected),treeSelectedchkBx.on("change",function(){$(this).is(":checked")?($(d).find(".select-all-siblings").hide(),d.countSelectedNodes()&&($(d).find("details").attr("open",!0),$(d).find("input.select-node").each(function(){$(this).is(":checked")?$(this).parent().show():$(this).parent().hide()}))):($(d).find(".select-all-siblings").show(),$(d).find("input.select-node").each(function(){$(this).parent().show()}))}))},buildToggleExpandCollapse=e=>{d.treesettings.tree_options&&d.treesettings.tree_options.expand_all&&(expandCollapseToggle=$("<div />",{class:"tree-option expand-collapse-all-nodes"}).appendTo(treeOptions),expandCollapseTogglechkBx=$("<input />",{type:"checkbox",class:"expand-collapse-toggle",id:"expand-all-nodes-"+d.id}).appendTo(expandCollapseToggle),expandCollapseToggleLabel=$("<label />",{type:"checkbox",for:"expand-all-nodes-"+d.id,html:d.treesettings.tree_options.expand_all_text}).appendTo(expandCollapseToggle),expandCollapseTogglechkBx.on("change",function(){$(this).is(":checked")?$(d).find("details").attr("open",!0):$(d).find("details").attr("open",!1)}))},createSpinner=()=>spinner=$("<div />",{class:"loading-ring",html:"<span></span>"}),triggerSelectAllSiblings=function(e,t){siblings=e.parent().parent().find(".tree-node"),e.is(":checked")?siblings.length&&!$(this).hasClass("select-all-siblings")&&(chkboxes=siblings.find("input[type=checkbox]")).each(function(){$(this).prop("checked",!0),$(this).trigger("change")}):siblings.length&&!$(this).hasClass("select-all-siblings")&&(chkboxes=siblings.find("input[type=checkbox]")).each(function(){$(this).prop("checked",!1),$(this).trigger("change")})},triggerSelectAllChildren=(e,t)=>{var l=d.data.url?500:0;setTimeout(function(){e.is(":checked")?((detailTag=e.parent().parent().parent()).attr("open",!0),(treeNodes=detailTag.find(".tree-node")).length&&"DETAILS"==detailTag.prop("nodeName")&&$(treeNodes.find("input[type=checkbox]")).each(function(){$(this).prop("checked",!0),$(this).trigger("change")})):((detailTag=e.parent().parent().parent()).attr("open",!0),(treeNodes=detailTag.find(".tree-node")).length&&"DETAILS"==detailTag.prop("nodeName")&&$(treeNodes.find("input[type=checkbox]")).each(function(){$(this).prop("checked",!1),$(this).trigger("change")}))},l)},disableAllRemainingNodes=()=>{$(d).find(".select-node").each(function(){$(this).is(":checked")||$(this).attr("disabled","disabled")})},enableAllRemainingNodes=()=>{$(d).find(".select-node").each(function(){$(this).removeAttr("disabled","disabled")})},disableChildren=e=>{e.is(":checked")?(detailTag=e.parent().parent().parent(),(treeNodes=detailTag.find(".tree-node")).length&&"DETAILS"==detailTag.prop("nodeName")&&$(treeNodes.find("input[type=checkbox]")).each(function(){$(this).attr("disabled","disabled")})):(detailTag=e.parent().parent().parent(),(treeNodes=detailTag.find(".tree-node")).length&&"DETAILS"==detailTag.prop("nodeName")&&$(treeNodes.find("input[type=checkbox]")).each(function(){$(this).removeAttr("disabled")}))},d.countAllNodes=()=>$(d).find(".tree-node-item").length,d.getSelectedNodes=()=>$(d).find("input.select-node:checked"),d.countSelectedNodes=()=>d.getSelectedNodes().length,d.triggerSelectNode=function(e){itemVal=e.val(),stext=e.next().text(),totalNodesSelected=d.countSelectedNodes(),$(d).find(".selected-count").html(totalNodesSelected),0<d.treesettings.select_options.max_nodes&&(totalNodesSelected>=self.treesettings.select_options.max_nodes?disableAllRemainingNodes:enableAllRemainingNodes)(),d.updateSelectedNodeTags(),d.treesettings.onNodeSelect&&d.treesettings.onNodeSelect.call(d,e,d.selectedNodes,totalNodesSelected)},d.updateSelectedNodeTags=()=>{for(d.selectedNodes=[],($selectedNodesWrapper=$(d).find(".selected-nodes")).html(""),$(d).find(".select-node").each(function(){var e,t;$(this).is(":checked")&&(e=$(this).val(),t=$(this).parent().find("label").text(),d.selectedNodes.push({value:e,label:t}))}),i=0;i<d.treesettings.select_options.max_selection_displayed_nodes;i++){var e,t;null!=d.selectedNodes[i]&&(e=(t=d.selectedNodes[i]).value,t=t.label,selectedNodeE=$("<div />",{class:"selected-node",id:"selected-node-"+d.key+"-"+e,"data-value":e}).appendTo($selectedNodesWrapper),$("<span />",{title:t,html:t}).appendTo(selectedNodeE),(unselectNode=$("<button />",{type:"button",title:"Remove "+t,html:"x",class:"btn-remove-selected-node"}).appendTo(selectedNodeE)).on("click",function(e){nodeId=$(this).parent().data("value"),chkbx=$("#"+d.id+"-"+nodeId),$(chkbx).is(":checked")&&($(chkbx).prop("checked",!1),d.updateSelectedNodeTags())}))}d.selectedNodes.length>d.treesettings.select_options.max_selection_displayed_nodes&&(maxText=(maxText=d.treesettings.select_options.more_nodes_text).replace(/\[(.*?)\]/g,d.countSelectedNodes()-d.treesettings.select_options.max_selection_displayed_nodes),moreSelectedNodes=$("<button />",{type:"button",class:"selected-node btn-more-selected-nodes",id:"selected-last-node"}).appendTo($selectedNodesWrapper),moreSelectedText=$("<span />",{html:maxText}).appendTo(moreSelectedNodes))},closeTree=function(e){$(e).parents().hasClass(l)||$(e).parents().hasClass("btn-remove-node")||$(".mz-tree-dropdown-plugin .tree-body").each(function(){$(this).removeClass(d.expandCollapseClass)})},$(document).on("click",".tree-header",function(e){$(e.target).find(".mz-tree-dropdown-filter").focus()}),$(document).on("click","body",function(e){closeTree(e.target)}),this.each(function(e){init()})}:console.log("JQUERY NOT INCLUDED IN PAGE");